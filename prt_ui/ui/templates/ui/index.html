<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <script src="{% static 'ui/js/jquery.js' %}" ></script>
<style>

    .num_workers {
    -moz-column-count: 2;
    -moz-column-gap: 30px;
    -webkit-column-count: 2;
    -webkit-column-gap: 30px;

    column-count: 2;
    column-gap: 2vw;
        -webkit-column-fill: auto; /* Chrome, Safari, Opera */
    -moz-column-fill: auto; /* Firefox */
    column-fill: auto;
    height: 90vh;
    width: 95vw;
    overflow-y: auto;
    overflow-x: hidden;
    margin-left: 2vw;

    }

    .enjoy-css2 {
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  float: right;

  top: 0;
  right: 5%;
  bottom: 0;
  left: 0;
  margin: 2% 0 2% 5%;
  overflow: scroll;
  border: 2px solid rgba(0,150,255,0.91);
  font: normal 17px/2 "Times New Roman", Times, serif;
  color: rgba(5,0,0,1);
    text-indent: 13px;
  text-align: justify;
  -o-text-overflow: ellipsis;
  text-overflow: ellipsis;
        width: 95%;
    height: 17vh;
    overflow: auto !important;
    border-style: solid;
    border-width: 5px !important;
}

.enjoy-css {
  -webkit-box-sizing: content-box;
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  width: 45%;
  height: 10%;
  position: relative;
  top: 0;
  right: 5%;
  bottom: 0;
  left: 0;
  margin: 2% 0 0% 5%;

  overflow-y: scroll;
  border: 2px solid rgba(0,150,255,0.91);
  font: normal 15px/1 "Times New Roman", Times, serif;
  color: rgba(5,0,0,1);
  text-align: justify;
  -o-text-overflow: ellipsis;
  text-overflow: ellipsis;
    overflow: scroll !important;
  border-style: solid;
  border-width: 5px !important;
}

.start-Worker {
    position: relative;
    box-shadow: 0 4px 6.5px 0 rgba(0,0,0,.7), inset 0px -3px 1px 1px rgba(204,198,197,.5);
    }
.start-Worker:active {
    top: 2px;
    }
.start-Worker.active {
    top: 2px;
    box-shadow: 0 0.3px 0.7px 0 rgba(0,0,0,.4), inset 0px -3px 1px 1px rgba(204,198,197,.5);
    }

</style>
<script type="text/javascript">
(function($) {

    $.ajaxSetup({
        type: 'POST',
        timeout: 3000,
        error: function() {
            alert("timeout!");
                     }
    })

    $.fn.addWorker = function( options, callbackFunc ) {
        var settings = $.extend({site:null}, options);
        $.post("{% url 'ui:ajax_create_process' %}", {ajaxarg_site:settings.site, csrfmiddlewaretoken:'{{ csrf_token }}'},
        function(data,status){
            alert(data);
            $("#num_workers").load("{% url 'ui:ajax_auto_reload' %}", {ajaxarg_site: settings.site, csrfmiddlewaretoken:'{{ csrf_token }}'});
        })
        .fail(function(){
            alert("error " + status );
        });
        return false;
    };

    $.fn.addToQ = function( options, callbackFunc ) {
        var settings = $.extend({site:null, proxy_name:null}, options);
        $.post("{% url 'ui:ajax_add_to_queue' %}", {ajaxarg_site:settings.site, ajaxarg_proxy_name:settings.proxy_name, csrfmiddlewaretoken:'{{ csrf_token }}'},
        function(data,status){
            alert(data);
            $("#num_workers").load("{% url 'ui:ajax_auto_reload' %}", {ajaxarg_site: settings.site, csrfmiddlewaretoken:'{{ csrf_token }}'});
        })
        .fail(function(){
            alert("error " + status );
        });
        return false;
    };


}(jQuery));
</script>
<script type="text/javascript">
$(document).ready(function(){
  $('.start-Worker')
    .filter(function() {
        return $(this).attr('data-pressed') == 'Paused';
     })
     .toggleClass('active');


  $("#sites").on("click", ".Add-Worker", function(){
    var lock = $(".Add-Worker").attr("data-locked");
    if (lock == "True") {
        return false;
    }
    $(".Add-Worker").attr('data-locked', "True");
    var site_name = $(this).closest("div").attr("id");
        $(this).addWorker({site: site_name}, function(){
        });

  });
  $("#sites").on("click", ".Add-To-Q", function(event){
    var lock = $(".Add-To-Q").attr("data-locked");
    if (lock == "True") {
        return false;
    }
    $(".Add-To-Q").attr('data-locked', "True");
    var site_name = $(this).closest("div").attr("id");
    var target_button = event.target.id;
    var proxy_name = $("#"+target_button).siblings("select").find("option:selected").attr("value");
        $(this).addToQ({site: site_name, proxy_name: proxy_name}, function(){
        });

  });
  $('.start-Worker').click(function() {
            var pressed = $(".start-Worker").attr("data-pressed");
            if (pressed == "False") {
            $(this).toggleClass('active');
            }
  });

});
</script>
</head>
<body>

<p>Welcome to PRT!</p>
<div  id="sites">
<div id="num_workers" class="num_workers">
{% for site, site_hash in active_workers.items %}
<div id="{{site}}" class="enjoy-css2">
    <button  style="margin-top:0" id="addWorker-{{site}}" data-locked="False" class="Add-Worker"> Add Worker   </button>
    <button  style="margin-top:0" id="addToQ-{{site}}"  data-locked="False" class="Add-To-Q"> Add To Queue   </button>
    <select name="proxies" id="proxies">
        {% for proxy_name in site_hash.proxies %}
            <option value="{{proxy_name}}">{{proxy_name}}</option>
        {% endfor %}
    </select>
<h3 class="text_data">{{site}}: {{site_hash.active_workers}} active workers</h3>
<ul>
    {% for pid, proc_hash in site_hash.workers.items %}
        <li>{{pid}} - status: {{proc_hash.status}}, currently working on: {{proc_hash.working_on}}, step: {{proc_hash.step}}
        <button  style="margin-top:0" id="{{pid}}-start" data-pressed="{{proc_hash.status}}" class="start-Worker">&#9658;</button>
        <button  style="margin-top:0" id="{{pid}}-pause" data-pressed="{{proc_hash.status}}" class="start-Worker">&#9646;&#9646;</button></li>
    {% endfor %}
</ul>


</div>
{% endfor %}
</div>


</div>
</body>
</html>